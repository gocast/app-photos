<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../app-route/app-location.html">
<link rel="import" href="../app-route/app-route.html">
<link rel="import" href="app-photos-albums-page.html">
<link rel="import" href="app-photos-album-page.html">
<link rel="import" href="animated-pages.html">

<!--
`app-photos`

@demo demo/app-photos.html 
-->
<dom-module id="app-photos">
  <template>
    <style>
      :host {
        display: block;
        height: 100%;
      }
    </style>

    <app-location route="{{route}}" use-hash-as-path></app-location>
    <app-route
        route="[[route]]"
        pattern="/:page"
        data="{{routeData}}"></app-route>
    
    <animated-pages page="[[page]]">
      <app-photos-albums-page
          name="albums"
          albums="{{data.albums}}"
          content-name="[[contentName]]"
          loading="{{loading}}"></app-photos-albums-page>

      <app-photos-album-page
          name="album"
          albums="{{data.albums}}"
          loading="{{loading}}"></app-photos-album-page>
    </animated-pages>

  </template>
</dom-module>

<script>
(function() {
  'use strict';

  Polymer({

    is: 'app-photos',

    properties: {

      data: {
        type: Object,
        observer: '_dataChanged',
        value: _ => {
          return {albums: [{title:'hola', photos: [{urls: []}]}]};
        }
      },

      release: Object,

      contentName: String,

      contentId: Number,

      dataUpdatedAt: Number,

      releaseUpdatedAt: Number,

      route: Object,

      routeData: Object,

      page: String,

      loading: Boolean

    },

    listeners: {
      'trigger-update': '_updateContent'
    },

    observers: [
      '_routePageChanged(routeData.page)',
      '_routePathChanged(route.path)'
    ],

    _routePageChanged(page) {
      if (page) {
        this.page = page;
      }
    },

    _routePathChanged(path) {
      // route.path doesn't fire changes when the path is cleared
      if (!path) {
        this.page = 'albums';
      }
    },

    // Ensure data integrity
    _dataChanged() {
      if (!this.data) {
        this.data = {};
      }

      if (!this.data.albums) {
        this.data.albums = [];
      }
    },

    _updateContent() {
      // Should be named update-content
      this.fire('content-update', {
        data: this.data,
        contentId: this.contentId,
        updateRelease: true
      });
    }

  });

}());
</script>