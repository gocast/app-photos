<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../goc-icons/goc-icons.html">
<link rel="import" href="../goc-styles/goc-styles.html">
<link rel="import" href="../overlay-container/animated-overlay-behavior.html">
<link rel="import" href="../app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="../paper-spinner/paper-spinner-lite.html">

<!--
`app-photos-new-album-overlay`


@demo demo/app-photos-new-album-overlay.html 
-->
<dom-module id="app-photos-new-album-overlay">
  <template>
    <style include="header-layout-styles button-styles form-styles">
      :host {
        background: var(--goc-background-color);
        bottom: 0;
        left: 0;
        position: absolute;
        right: 0;
        top: 0;
      }
    </style>

    <div class="header-layout">
      <div class="header-layout__header">
        <div class="header-toolbar">
          <paper-icon-button on-tap="_closeTapped" icon="close"></paper-icon-button>
          <div class="header-toolbar__main-content">
            <div class="header-toolbar__title">[[_computeHeaderTitle(album, localize)]]</div>
          </div>
          <paper-spinner-lite class="header-toolbar__spinner" active="[[loading]]"></paper-spinner-lite>
          <button class="button" on-tap="_submit">[[_computeHeaderSubmit(album, localize)]]</button>
        </div>
      </div>

      <div class="header-layout__content">
        <div class="form">
          <div class="form__item form__item--last">
            <label class="form__label">[[localize('NewAlbumOverlay.Form.TitleLabel')]]</label>
            <input
                id="titleInput"
                class="form__input"
                placeholder="[[localize('NewAlbumOverlay.Form.TitleLabel')]]"
                value$="[[album.title]]"
                on-keyup="_validate">
          </div>
        </div>
      </div>
    </div>

  </template>
</dom-module>

<script>
(function() {
  'use strict';

  Polymer({

    is: 'app-photos-new-album-overlay',

    properties: {

      albums: Array,

      album: {
        type: Object,
        value: null
      },

      language: {
        type: String,
        value: 'en'
      }

    },

    behaviors: [
      AnimatedOverlayBehavior,
      Polymer.AppLocalizeBehavior
    ],

    listeners: {
      'overlay-open-animation-finish': '_onOverlayOpenAnimationFinish',
      'keydown': '_onKeydown'
    },

    attached() {
      this.loadResources(this.resolveUrl('locales/app.json'));
    },

    _albumsChanged() {
      this._albumsTitles
    },

    _validate() {
      let valid = true;

      const title = this.$.titleInput.value;
      const titleValid = title.length && !this.albums.filter(album => {
        return album.title === title;
      }).length;

      valid = valid && titleValid;

      if (titleValid) {
        this.$.titleInput.parentElement.classList.remove('form__item--invalid');
      } else {
        this.$.titleInput.parentElement.classList.add('form__item--invalid');
      }

      return valid;
    },

    _submit() {
      if (this._validate()) {
        this._setCanceled(false);
        this.opened = false;
      }
    },

    _onKeydown(event) {
      const enterKey = 13;

      if (event.keyCode === enterKey) {
        this._submit();
      }
    },

    _onOverlayOpenAnimationFinish() {
      this.$.titleInput.focus();
    },

    _closeTapped() {
      this._setCanceled(true);
      this.opened = false;
    },

    _computeHeaderTitle(album) {
      if (album) {
        return this.localize('NewAlbumOverlay.Header.EditTitle');
      }
      return this.localize('NewAlbumOverlay.Header.CreateTitle');
    },

    _computeHeaderSubmit(album) {
      if (album) {
        return this.localize('NewAlbumOverlay.Header.SubmitEdit');
      }
      return this.localize('NewAlbumOverlay.Header.SubmitCreate');      
    }

  });

}());
</script>